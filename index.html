<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>AI Object Detector</title>

  <!-- Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <!-- ml5.js -->
  <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>

  <style>
    body {
      margin:0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #071029, #0f3a4b);
      color: #00ffd1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      text-align:center;
    }

    h1 {
      font-size: 2.4rem;
      margin-bottom: 4px;
      text-shadow: 0 0 12px #00ffd1, 0 0 24px #00ffd1;
      letter-spacing:1px;
    }

    p {
      font-size:1.1rem;
      margin-bottom:20px;
      color:#cfeeee;
    }

    .video-wrap {
      position:relative;
      width:80vw;
      max-width:800px;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 10px 30px rgba(0,0,0,0.7);
      margin-bottom:20px;
    }

    video, canvas {
      width:100%;
      height:auto;
      transform: scaleX(-1);
    }

    canvas {
      position:absolute;
      top:0;
      left:0;
      pointer-events:none;
    }

    .toggle-container {
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-bottom:30px;
      font-size:1.1rem;
    }

    .glow-btn {
      background:#00ffd1;
      color:#071029;
      font-weight:bold;
      padding:10px 20px;
      border-radius:8px;
      box-shadow:0 0 20px #00ffd1;
      cursor:pointer;
      border:none;
    }

    .status {
      font-size:0.95rem;
      color:#bfeee7;
    }
  </style>
</head>
<body>
  <h1>✨ AI Object Detector ✨</h1>
  <p>Watch your world come alive with AI detection!</p>

  <div class="video-wrap">
    <video id="video" playsinline autoplay muted></video>
    <canvas id="overlay"></canvas>
  </div>

  <div class="toggle-container">
    <span>AI Off</span>
    <label class="switch">
      <input type="checkbox" id="aiToggle" disabled>
      <span class="lever"></span>
    </label>
    <span>AI On</span>
  </div>

  <div class="status">Model: <strong id="modelState">loading…</strong></div>

  <script>
  (function(){
    const video = document.getElementById('video');
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');
    const aiToggle = document.getElementById('aiToggle');
    const modelStateEl = document.getElementById('modelState');
    let detector, modelLoaded=false, boundingCache=[];

    function colorForLabel(label){
      let hash=0; for(let i=0;i<label.length;i++) hash=label.charCodeAt(i)+((hash<<5)-hash);
      return `hsl(${Math.abs(hash)%360} 90% 55%)`;
    }

    async function startCamera(){
      try{
        const stream = await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720}, audio:false});
        video.srcObject=stream; await video.play();
        canvas.width=video.videoWidth; canvas.height=video.videoHeight;
      } catch(e){ modelStateEl.textContent='No camera'; console.error(e); }
    }

    function drawFrame(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      boundingCache.forEach(obj=>{
        ctx.strokeStyle=colorForLabel(obj.label);
        ctx.lineWidth=3; ctx.strokeRect(obj.x,obj.y,obj.width,obj.height);
        ctx.fillStyle='rgba(0,0,0,0.5)';
        const text=`${obj.label} ${(obj.confidence*100).toFixed(1)}%`;
        ctx.fillRect(obj.x,obj.y-20,ctx.measureText(text).width+10,20);
        ctx.fillStyle=colorForLabel(obj.label);
        ctx.fillText(text,obj.x+5,obj.y-5);
      });
      requestAnimationFrame(drawFrame);
    }

    function detectLoop(){
      if(detector && aiToggle.checked){
        detector.detect(video,(err,results)=>{
          if(!err) boundingCache = results.map(r=>({label:r.label, confidence:r.confidence||0, x:r.x, y:r.y, width:r.width, height:r.height}));
        });
      }
      setTimeout(detectLoop, 100);
    }

    async function loadModel(){
      modelStateEl.textContent='loading…';
      detector = await ml5.objectDetector('cocossd',{},()=>{ modelLoaded=true; aiToggle.disabled=false; modelStateEl.textContent='ready'; });
    }

    startCamera();
    loadModel();
    drawFrame();
    detectLoop();
  })();
  </script>
</body>
</html>
