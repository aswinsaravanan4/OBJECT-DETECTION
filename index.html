<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AI Object Detection — Mobile & Desktop</title>

<!-- Materialize CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
<!-- ml5.js -->
<script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>

<style>
:root{
  --width-desktop: 800px;
  --height-desktop: 560px;
  --accent: #00ffd1;
  --bg1: #071029;
  --bg2: #0f3a4b;
}

html, body {
  height:100%;
  margin:0;
  font-family:"Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: linear-gradient(135deg,var(--bg1),var(--bg2));
  color:#e8f6f5;
  overflow-x:hidden;
}

/* ===== Animated Gradient Title ===== */
.glow-title {
  font-weight:700;
  font-size:2rem;
  background: linear-gradient(90deg,#00ffd1,#ff00ff,#00ffd1);
  background-size:300% 300%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation: gradientAnim 3s ease infinite;
  text-shadow: 0 0 12px rgba(0,255,209,0.2), 0 0 18px rgba(255,0,255,0.1);
}
@keyframes gradientAnim{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

.container-centered{
  max-width:1100px;
  margin:24px auto;
  padding:18px;
  text-align:center;
}

.video-wrap{
  margin:18px auto;
  width: var(--width-desktop);
  max-width:95%;
  position:relative;
  border-radius:14px;
  overflow:hidden;
  box-shadow: 0 10px 50px rgba(0,0,0,0.7), 0 0 40px rgba(0,255,209,0.08) inset;
  background: rgba(0,0,0,0.18);
}

video{
  display:block;
  width:100%;
  height:auto;
  transform: scaleX(-1);
}

canvas{
  position:absolute;
  top:0; left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  transform: scaleX(-1);
}

/* ===== Floating AI button ===== */
#aiButton{
  position:absolute;
  bottom:12px;
  right:12px;
  background: rgba(0,255,209,0.9);
  color: #071029;
  border:none;
  padding:10px 16px;
  font-size:0.9rem;
  font-weight:bold;
  border-radius:8px;
  cursor:pointer;
  z-index:10;
  box-shadow: 0 4px 12px rgba(0,255,209,0.4);
}
#aiButton:hover{
  opacity:0.85;
}

/* ===== Particles Background ===== */
#particles{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  z-index:-1;
  pointer-events:none;
  background: radial-gradient(circle at center, #071029 0%, #0f3a4b 100%);
}

@media(max-width:720px){
  :root { --width-desktop:95vw; }
  .glow-title { font-size:1.6rem; }
  #aiButton { padding:8px 12px; font-size:0.85rem; }
}
</style>
</head>
<body>
<div id="particles"></div>

<div class="container-centered">
  <h1 class="glow-title">⚡ AI Object Detection ⚡</h1>

  <div id="videoArea" class="video-wrap" aria-live="polite">
    <video id="video" playsinline autoplay muted></video>
    <canvas id="overlay"></canvas>

    <!-- Floating AI Toggle Button -->
    <button id="aiButton">Turn AI On</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

<script>
// ===== Particles Background =====
particlesJS("particles", {
  "particles": {
    "number": { "value": 80 },
    "size": { "value": 2 },
    "color": { "value": "#00ffd1" },
    "line_linked": { "enable": true, "distance": 120, "color": "#00ffd1", "opacity": 0.3, "width": 1 },
    "move": { "speed": 1, "out_mode": "bounce" }
  }
});
</script>

<script>
(async function(){
const video = document.getElementById('video');
const canvas = document.getElementById('overlay');
const ctx = canvas.getContext('2d', {alpha:true});
const aiButton = document.getElementById('aiButton');

let detector=null, modelLoaded=false, boundingCache=[], pulse=0;
let aiActive = false;

function colorForLabel(label){
  let hash=0; for(let i=0;i<label.length;i++) hash=label.charCodeAt(i)+((hash<<5)-hash);
  const h=Math.abs(hash)%360;
  return `hsl(${h} 90% 55%)`;
}

async function startCamera(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{ width:{ideal:1280}, height:{ideal:720}, facingMode:"environment" }, audio:false});
    video.srcObject=stream; await video.play();
    await new Promise(resolve=>{if(video.readyState>=2)resolve(); else video.addEventListener('loadedmetadata',resolve,{once:true});});
    resizeCanvasToVideo(); window.addEventListener('resize', resizeCanvasToVideo);
  }catch(err){ console.error(err); alert('Camera access denied or unavailable'); }
}

function resizeCanvasToVideo(){
  const rect=video.getBoundingClientRect();
  const ratio=window.devicePixelRatio||1;
  canvas.width=(video.videoWidth||rect.width)*ratio;
  canvas.height=(video.videoHeight||rect.height)*ratio;
  canvas.style.width=rect.width+'px';
  canvas.style.height=rect.height+'px';
  ctx.setTransform(ratio,0,0,ratio,0,0);
}

function loadModel(){
  return new Promise((resolve)=>{
    detector=ml5.objectDetector('cocossd',{},()=>{ modelLoaded=true; resolve(detector); });
  });
}

function drawFrame(now){
  resizeCanvasToVideo();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save(); ctx.drawImage(video,0,0,canvas.width,canvas.height); ctx.restore();

  pulse=(Math.sin(now/500)+1)/2;
  boundingCache.forEach(obj=>{
    const color=colorForLabel(obj.label);
    ctx.save();
    ctx.strokeStyle=color;
    ctx.lineWidth=Math.max(2,Math.round(canvas.width/320));
    ctx.shadowColor=color;
    ctx.shadowBlur=12*pulse+2;
    ctx.strokeRect(obj.x,obj.y,obj.width,obj.height);
    const label=`${obj.label} ${(obj.confidence*100).toFixed(1)}%`;
    ctx.font=`${14+Math.round(canvas.width/500)}px Arial`;
    const padding=6; const metrics=ctx.measureText(label);
    const textW=metrics.width+padding*2; const textH=parseInt(ctx.font,10)+padding*0.8;
    ctx.fillStyle='rgba(0,0,0,0.55)'; ctx.fillRect(obj.x,Math.max(0,obj.y-textH),textW,textH);
    ctx.fillStyle=color; ctx.fillText(label,obj.x+padding,Math.max(textH-(padding/2),obj.y+4));
    ctx.restore();
  });

  requestAnimationFrame(drawFrame);
}

function detectionLoop(){
  if(modelLoaded && aiActive && detector){
    detector.detect(video,(err,results)=>{
      if(!err && results){
        boundingCache=results.map(r=>({label:r.label,confidence:r.confidence||0,x:r.x,y:r.y,width:r.width,height:r.height}));
      }
    });
  }
  requestAnimationFrame(detectionLoop);
}

async function init(){
  await startCamera();
  await loadModel();
  requestAnimationFrame(drawFrame);
  requestAnimationFrame(detectionLoop);
}

// ===== Floating Button Event =====
aiButton.addEventListener('click',()=>{
  aiActive = !aiActive;
  aiButton.textContent = aiActive ? 'AI On' : 'Turn AI On';
});

init();
})();
</script>
</body>
</html>
